-- FLUSH 
ALTER SYSTEM FLUSH buffer_cache;
ALTER SYSTEM FLUSH shared_pool;

VARIABLE  START_TIME_CLOB NUMBER;
EXEC :START_TIME_CLOB := EXTRACT(SECOND FROM SYSTIMESTAMP);
-- START MIERZENIA CZASU

SELECT CST.CUSTOMERNUMBER, CST.CITY, XMLTYPE(OFC.details).EXTRACT('//office/city/text()').getstringval() AS OFFICE_CITY FROM CUSTOMERS CST
INNER JOIN EMPLOYEES EMP ON CST.SALESREPEMPLOYEENUMBER = EMP.EMPLOYEENUMBER
INNER JOIN OFFICES_CLOB OFC ON EMP.OFFICECODE = OFC.OFFICECODE
WHERE CST.CITY = XMLTYPE(OFC.details).EXTRACT('//office/city/text()').getstringval();

VARIABLE  TIME_FOR_CLOB NUMBER;
EXEC :TIME_FOR_CLOB := EXTRACT(SECOND FROM SYSTIMESTAMP)-:START_TIME_CLOB;
spool etap3_E2_CLOB_results.txt append;
PRINT TIME_FOR_CLOB;
spool off;