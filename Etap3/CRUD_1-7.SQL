--Crud_1-7
-- FLUSH 
ALTER SYSTEM FLUSH buffer_cache;
ALTER SYSTEM FLUSH shared_pool;

VARIABLE  START_TIME_CRUD NUMBER;
EXEC :START_TIME_CRUD := EXTRACT(SECOND FROM SYSTIMESTAMP);
-- START MIERZENIA CZASU
--1
DELETE FROM ORDERS ORD1
WHERE ORD1.ORDERNUMBER IN (SELECT ORD.ORDERNUMBER FROM ORDERS ORD
INNER JOIN ORDERDETAILS ORDD ON ORD.ORDERNUMBER = ORDD.ORDERNUMBER
WHERE ORDD.ORDERLINENUMBER = 7);



--2
insert  into orders(orderNumber,orderDate,requiredDate,shippedDate,status,comments,customerNumber)
SELECT
        999999 + CSTN,
        to_date('2020-04-20','YYYY-MM-DD'),
        to_date('2020-04-20','YYYY-MM-DD'),
        NULL,
        'In Process',
        NULL,
        CSTN
FROM (SELECT CST.CUSTOMERNUMBER AS CSTN FROM CUSTOMERS CST
INNER JOIN EMPLOYEES EMP ON CST.SALESREPEMPLOYEENUMBER = EMP.EMPLOYEENUMBER
WHERE EMP.EMPLOYEENUMBER = 1323);

insert  into orderdetails(orderNumber,productCode,quantityOrdered,priceEach,orderLineNumber)
SELECT
ORDN,
'S24_1046',
10,
60,
12
FROM
(SELECT ORD.ORDERNUMBER AS ORDN FROM ORDERS ORD 
WHERE ORD.ORDERNUMBER > 999999);

insert  into orderdetails(orderNumber,productCode,quantityOrdered,priceEach,orderLineNumber)
SELECT
ORDN,
'S12_3148',
10,
60,
12
FROM
(SELECT ORD.ORDERNUMBER AS ORDN FROM ORDERS ORD 
WHERE ORD.ORDERNUMBER > 999999);

insert  into orderdetails(orderNumber,productCode,quantityOrdered,priceEach,orderLineNumber)
SELECT
ORDN,
'S12_4473',
10,
60,
12
FROM
(SELECT ORD.ORDERNUMBER AS ORDN FROM ORDERS ORD 
WHERE ORD.ORDERNUMBER > 999999);

--3
insert  into payments(customerNumber,checkNumber,paymentDate,amount)
SELECT 
CST.CUSTOMERNUMBER,
'TEST123',
to_date('2020-04-20','YYYY-MM-DD'),
1000
FROM CUSTOMERS CST
WHERE CST.CUSTOMERNUMBER = 103;

--4
UPDATE CUSTOMERS CST
SET CST.CREDITLIMIT = CST.CREDITLIMIT + 1000
WHERE CST.CUSTOMERNUMBER IN
(SELECT CST.CUSTOMERNUMBER FROM CUSTOMERS CST 
INNER JOIN PAYMENTS PMN ON CST.CUSTOMERNUMBER = PMN.CUSTOMERNUMBER
WHERE PMN.AMOUNT > 10000 AND CST.COUNTRY = 'USA'
GROUP BY CST.CUSTOMERNUMBER);

--5
SELECT * FROM PAYMENTS PMN
WHERE PMN.PAYMENTDATE BETWEEN to_date('2004-10-22','YYYY-MM-DD') 
AND to_date('2004-12-31','YYYY-MM-DD');

--6
DELETE FROM CUSTOMERS CST1
WHERE CST1.CUSTOMERNUMBER IN
(SELECT CST.CUSTOMERNUMBER FROM CUSTOMERS CST
INNER JOIN EMPLOYEES EMP ON CST.SALESREPEMPLOYEENUMBER = EMP.EMPLOYEENUMBER
INNER JOIN OFFICES OFC ON EMP.OFFICECODE = OFC.OFFICECODE
WHERE OFC.COUNTRY = 'USA');

--7
SELECT * FROM CUSTOMERS CST
INNER JOIN EMPLOYEES EMP ON CST.SALESREPEMPLOYEENUMBER = EMP.EMPLOYEENUMBER
INNER JOIN OFFICES OFC ON EMP.OFFICECODE = OFC.OFFICECODE
WHERE OFC.CITY = CST.CITY;

VARIABLE  TIME_FOR_CRUD NUMBER;
EXEC :TIME_FOR_CRUD := EXTRACT(SECOND FROM SYSTIMESTAMP)-:START_TIME_CRUD;
spool etap3_results.txt append;
PRINT TIME_FOR_CRUD;
spool off;
ROLLBACK;
